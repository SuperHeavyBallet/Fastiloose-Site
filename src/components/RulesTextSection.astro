---
import data from "../assets/content/core_rules.json";

const NAME_RX = /(Fastiloose!?)/gi;
const NAME_RX_EXACT = /^Fastiloose!?$/i;

// split on ANY of these tokens (capturing group keeps them in the array)
const ALL_RX =
  /(Fastiloose!?|\bHEALTH\b|\bMOV\b|\bHIT\b|\bDEF\b|\bRANGE\b|\bDAMAGE\b|\bAREA\b|\bBase Classes\b|\bFate Deck\b)/gi;
// exact check for a split chunk
const ALL_EXACT =
  /^(?:Fastiloose!?|HEALTH|MOV|HIT|DEF|RANGE|DAMAGE|AREA|Base Classes|Fate Deck)$/i;


const sections = data.rules.map((r, i) => {
  const slug = r.title.toLowerCase().replace(/\s+/g,"-").replace(/[^a-z0-9-]/g,"");
  return { ...r, id: `section-${i+1}-${slug}` };
});
---


<main class="rule-display">
    {sections.map((s) => (
      <section id={s.id}>
        <h2>{s.title}</h2>
  
        {s.blocks.map((b) => {
          if (b.type === "h3") {
            return (
              <h3>
                {b.text.split(NAME_RX).map((chunk) =>
                  NAME_RX_EXACT.test(chunk) ? <strong>{chunk}</strong> : chunk
                )}
              </h3>
            );
          }
  
          if (b.type === "p") {
            return (
              <p>
                {b.text.split(ALL_RX).map((chunk) =>
                  ALL_EXACT.test(chunk) ? <strong>{chunk}</strong> : chunk
                )}
              </p>
            );
          }
  
          if (b.type === "ul") {
            return (
              <ul>
                {b.items.map((it) => (
                  <li>
                    {it.split(ALL_RX).map((chunk) =>
                      ALL_EXACT.test(chunk) ? <strong>{chunk}</strong> : chunk
                    )}
                  </li>
                ))}
              </ul>
            );
          }
  
          if (b.type === "img") {
            return (
              <img
                src={b.src}
                alt={b.alt}
                width={b.width}
                height={b.height}
                loading="lazy"
                decoding="async"
              />
            );
          }
  
          return null;
        })}
      </section>
    ))}
  </main>

  <style>

    img{
        max-width: 10rem;
    }
  </style>
